server {\n    listen 8080;\n    server_name _;\n\n    # Основные настройки\n    client_max_body_size 50M;\n    proxy_read_timeout 300s;\n    proxy_connect_timeout 75s;\n\n    # Логирование\n    access_log /var/log/nginx/access.log;\n    error_log /var/log/nginx/error.log;\n\n    # API маршруты\n    location /api/ {\n        proxy_pass http://backend:4000/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # ImgProxy для обработки изображений\n    location /imgproxy/ {\n        proxy_pass http://imgproxy:8080/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n\n    # Статические файлы фронтенда\n    location / {\n        proxy_pass http://frontend:5173/;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        \n        # Поддержка WebSocket для hot reload в dev режиме\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \"upgrade\";\n    }\n\n    # Обработка ошибок\n    error_page 404 /404.html;\n    error_page 500 502 503 504 /50x.html;\n}